# =====================================================================
# Veracode DevSecOps Workflow - Fluxo Ilustrativo
# =====================================================================
#
#                          FLUXO DO PIPELINE
#
#  Start
#    â”‚
#    â”œâ”€â”€> Checkout do CÃ³digo
#    â”‚       â””â”€â”€â†’ Veracode SCA (paralelo)
#    â”‚
#    â”œâ”€â”€> Preparar Ambiente
#    â”‚
#    â”œâ”€â”€> VerificaÃ§Ã£o de GovernanÃ§a
#    â”‚
#    â”œâ”€â”€> Compilar Projeto (se necessÃ¡rio conforme linguagem)
#    â”‚
#    â”œâ”€â”€> Testes Appsec
#    â”‚       â”œâ”€â”€â†’ Pipeline Scan
#    |       â”œâ”€â”€â†’ Quality Gate
#    â”‚       â”œâ”€â”€â†’ SAST 
#    â”‚       â””â”€â”€â†’ Envio Issues
#    â”‚
#    â”œâ”€â”€> Sistema de regra ou testes QA (ilustrativo)
#    â”‚
#    â”œâ”€â”€> Ofuscar JavaScript (ilustrativo)
#    â”‚
#    â”œâ”€â”€> Publicar artefato (ilustrativo)
#    â””â”€â”€> Deploy (ilustrativo)
#
# =====================================================================

name: Veracode DevSecOps 

on:
  workflow_call:
  
    inputs:
      # Variaveis que os projetos podem sobrescrever
      environment:
        description: 'Ambiente de execuÃ§Ã£o do build'
        required: true
        type: string
      project:
        description: 'Nome do projeto'
        required: true
        type: string
       
env:
  PROJECT: ${{ inputs.project_veracode }}
  ENVIRONMENT: ${{ inputs.environment }}

jobs:
  # â”€â”€â”€ Job de Checkout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  checkout:
    name: ğŸ“¥ Checkout do CÃ³digo
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4

  # â”€â”€â”€ Job que chama o template Veracode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  veracode:
    name: ğŸ›¡ï¸ Executar Veracode SCA/SAST
    needs: checkout
    uses: LaisLora/github-actions-templates/.github/workflows/veracode-template.yml@main
    secrets: inherit
    with:
      build-id: ${{ inputs.build-id }}
      environment: ${{ inputs.environment }}
      project_veracode: ${{ inputs.project }}
      
